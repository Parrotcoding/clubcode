<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Instructor Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <style>
    body { font-family:system-ui,Arial,sans-serif; margin:1rem auto; max-width:800px }
    h1,h2 { color:#0c4a7f }
    .quiz-item, .question-block { border:1px solid #ddd; padding:1rem; margin-bottom:1rem }
    .quiz-item div { display:flex; justify-content:space-between; }
    button { margin:.3rem; }
    label, input, textarea { width:100%; margin:.4rem 0 }
    .choice { display:flex; align-items:center; }
    .choice input[type="checkbox"] { margin-right:.5rem }
  </style>
</head>
<body>
  <h1>Instructor Dashboard</h1>

  <section>
    <h2>Existing Quizzes</h2>
    <div id="quizList"></div>
  </section>

  <section>
    <h2>Create Multi‚ÄêQuestion Quiz</h2>
    <form id="quizForm">
      <input name="id" placeholder="Quiz ID (e.g. q5)" required>
      <div id="questionsContainer"></div>
      <button type="button" id="addQuestion">Add Question</button>
      <button type="submit">Save Quiz</button>
    </form>
  </section>

  <script>
    window.addEventListener('DOMContentLoaded', async () => {
      const URL = 'https://kqprtnxmostvagtildsn.supabase.co';
      const KEY = 'YOUR_ANON_KEY';
      const supa = supabase.createClient(URL, KEY);

      // Render quiz list
      async function loadList() {
        const { data } = await supa.from('quizzes').select('*').order('id');
        const list = document.getElementById('quizList');
        list.innerHTML = data.map(q=>`
          <div class="quiz-item">
            <div><strong>${q.id}:</strong> ${q.title}</div>
            <div>
              <button onclick="togglePub('${q.id}',${!q.published})">
                ${q.published?'Unpublish':'Publish'}
              </button>
              <button onclick="deleteQuiz('${q.id}')">Delete</button>
            </div>
          </div>
        `).join('');
      }
      window.togglePub = async (id,p) => {
        await supa.from('quizzes').update({ published:p }).eq('id',id);
        loadList();
      };
      window.deleteQuiz = async id => {
        await supa.from('quizzes').delete().eq('id',id);
        loadList();
      };
      loadList();

      // Quiz builder
      const qForm = document.getElementById('quizForm');
      const qContainer = document.getElementById('questionsContainer');
      document.getElementById('addQuestion').onclick = () => {
        const idx = qContainer.children.length;
        const block = document.createElement('div');
        block.className = 'question-block';
        block.innerHTML = `
          <input name="prompt${idx}" placeholder="Question prompt" required>
          ${['A','B','C','D'].map((l,j)=>`
            <div class="choice">
              <input type="checkbox" name="correct${idx}" value="${j}">
              <input placeholder="Choice ${l}" name="choice${idx}${j}" required>
            </div>
          `).join('')}
        `;
        qContainer.appendChild(block);
      };
      document.getElementById('addQuestion').click();

      // Save quiz
      qForm.onsubmit = async e => {
        e.preventDefault();
        const f = new FormData(qForm);
        const id = f.get('id');
        const questions = Array.from(qContainer.children).map((blk, i) => {
          const prompt = f.get(`prompt${i}`);
          const choices = [0,1,2,3].map(j=>f.get(`choice${i}${j}`));
          const correctIdx = +f.get(`correct${i}`) || 0;
          return { prompt, choices, correctIdx };
        });
        await supa.from('quizzes').upsert([{
          id,
          title: questions[0].prompt,
          questions: questions,
          published: false
        }]);
        alert('Quiz saved. Publish when ready.');
        qForm.reset();
        qContainer.innerHTML = '';
        document.getElementById('addQuestion').click();
        loadList();
      };
    });
  </script>
</body>
</html>
