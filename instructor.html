<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Instructor Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <style>
    body { font-family:system-ui,Arial,sans-serif; margin:1rem auto; max-width:800px; }
    h1,h2 { color:#0c4a7f; }
    table { width:100%; border-collapse:collapse; margin-bottom:1rem; }
    th,td { border:1px solid #ddd; padding:.5rem; }
    button { padding:.3rem .6rem; }
    form > * { display:block; margin:.4rem 0; width:100%; }
  </style>
</head>
<body>
  <h1>Instructor Dashboard</h1>

  <section>
    <h2>Manage Resources</h2>
    <table>
      <thead><tr><th>Title</th><th>Published</th><th>Action</th></tr></thead>
      <tbody id="resTable"></tbody>
    </table>
  </section>

  <section>
    <h2>Create Quiz</h2>
    <form id="quizForm">
      <input name="id" placeholder="ID (e.g. q5)" required>
      <input name="question" placeholder="Question text" required>
      <textarea name="choices" placeholder='Choices as JSON array, e.g. ["A","B","C","D"]' required></textarea>
      <input name="answer" type="number" placeholder="Correct index (0–3)" required min="0" max="3">
      <button type="submit">Add Quiz</button>
    </form>
  </section>

  <section>
    <h2>Quiz Submissions</h2>
    <button id="refreshSubs">Refresh</button>
    <div id="subs"></div>
  </section>

<script>
  const SUPABASE_URL = 'https://kqprtnxmostvagtildsn.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtxcHJ0bnhtb3N0dmFndGlsZHNuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU1MzkzNzcsImV4cCI6MjA2MTExNTM3N30.-vU2hAJuA7JLkRjj1iOBAN9Y0pDEr3DU4XKjEp7NOUc';
  const supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_KEY);

  // Load/manage resources
  async function loadResources() {
    const { data } = await supabase.from('resources').select('*').order('title');
    const tbody = document.getElementById('resTable');
    tbody.innerHTML = data.map(r=>`
      <tr>
        <td>${r.title}</td>
        <td>${r.published}</td>
        <td>
          <button onclick="toggleRes('${r.id}',${!r.published})">
            ${r.published?'Unpublish':'Publish'}
          </button>
        </td>
      </tr>
    `).join('');
  }
  async function toggleRes(id, pub){
    await supabase.from('resources').update({ published:pub }).eq('id',id);
    loadResources();
  }

  // Create quiz
  document.getElementById('quizForm').onsubmit = async e => {
    e.preventDefault();
    const f = new FormData(e.target);
    await supabase.from('quizzes').insert([{
      id:       f.get('id'),
      question: f.get('question'),
      choices:  f.get('choices'),
      answer:   +f.get('answer')
    }]);
    alert('Quiz added');
  };

  // Load submissions
  async function loadSubs(){
    const { data } = await supabase
      .from('submissions')
      .select('quiz_id,student,answer_idx,correct,time')
      .order('time', { ascending:false });
    document.getElementById('subs').innerHTML = data.map(s=>
      `<div>${s.student} answered Quiz ${s.quiz_id}: ${s.correct?'✅':'❌'} at ${new Date(s.time).toLocaleString()}</div>`
    ).join('') || '<p>No submissions yet.</p>';
  }
  document.getElementById('refreshSubs').onclick = loadSubs;

  // Initial load
  loadResources();
  loadSubs();
</script>
</body>
</html>
